import { __decorate } from "tslib";
import { ÉµAction as Action } from '../decorators';
import { BaseState } from './base.state';
/**
 *	@class
 *	@abstract
 *	@classdes Array state class. Implementing base array functionality.
 */
export class ArrayState extends BaseState {
    /**
     * 	Return item by quired index.
     *	@public
     *	@param {Number} index - Quired index
     *  @deprecated use `this.data[index]` instead
     *	@return {Generic} quired item.
     */
    getByIndex(index) {
        const items = this.data;
        return items[index];
    }
    /**
     * 	Unshift item to array in state.
     *	@public
     *	@param {Generic} item - Item needs to unshift.
     */
    unshiftItem(item) {
        const items = this.data;
        items.unshift(item);
        this.setNewValue(items);
    }
    /**
     * 	Shift array in state.
     *	@public
     */
    shift() {
        const items = this.data;
        items.shift();
        this.setNewValue(items);
    }
    /**
     * 	Pop array in state.
     *	@public
     */
    pop() {
        const items = this.data;
        items.pop();
        this.setNewValue(items);
    }
    /**
     * 	Concat current state with another array.
     *	@param {T[]} array - Another array to concat with the current state.
     *	@public
     */
    concatWith(array) {
        const items = this.data;
        const newItems = items.concat(array);
        this.setNewValue(newItems);
    }
    /**
     * 	Push item to array in state.
     *	@public
     *	@param {Generic} item - Item needs to push
     */
    pushItem(item) {
        const items = this.data;
        items.push(item);
        this.setNewValue(items);
    }
    /**
     * 	Insert item in array by index.
     *	@public
     *	@param {number} index - Index where to insert new item.
     *	@param {Generic} item - Item need to insert.
     */
    insertItemByIndex(index, item) {
        const items = this.data;
        items.splice(index, 0, item);
        this.setNewValue(items);
    }
    /**
     * 	Remove item in array by item identify param (using `compareItems` method).
     *	@public
     *	@param {Generic} itemId - Id of item you want to remove.
     */
    removeItem(item) {
        const index = this.data.findIndex((_item) => this.compareItems(item, _item));
        return this.removeItemByIndex(index);
    }
    /**
     * 	Remove item in array by item id (using `getItemId` method).
     *	@public
     *	@param {Generic} itemId - Id of item you want to remove.
     */
    removeItemById(itemId) {
        const index = this.data.findIndex((_item) => itemId === this.getItemId(_item));
        return this.removeItemByIndex(index);
    }
    /**
     * 	Remove item in array by index.
     *	@public
     *	@param {number} index - Index of item you want to remove.
     */
    removeItemByIndex(index) {
        const items = this.data;
        const removedItem = this.data[index];
        items.splice(index, 1);
        this.setNewValue(items);
        return removedItem;
    }
    /**
     * 	Update item in array by item identify param (using `compareItems` method).
     *	@public
    *	@param {Generic} itemToUpdate - item that will be update.
    */
    updateItem(itemToUpdate) {
        const items = this.data;
        const newItemToUpdate = { ...itemToUpdate };
        const itemIndex = items.findIndex((_currentItem) => this.compareItems(_currentItem, newItemToUpdate));
        items[itemIndex] = newItemToUpdate;
        this.setNewValue(items);
    }
    /**
     * 	Update item in array by index.
     *	@public
     *	@param {Generic} itemToUpdate - item that will be update.
     *	@param {Generic} index - index of item that need to update.
     */
    updateItemByIndex(itemToUpdate, index) {
        const items = this.data;
        items[index] = itemToUpdate;
        this.setNewValue(items);
    }
    setNewValue(value) {
        if (value) {
            super.setNewValue([...value]);
        }
        else {
            super.setNewValue(null);
        }
    }
    catchError(error, actionName) {
        if (error instanceof TypeError) {
            throw new Error(`\n${this.constructor.name} [${actionName}]: ` +
                `Firstly set Array.\n\n${error.message}`);
        }
        super.catchError(error, actionName);
    }
    /**
     *	Must return identify param of item.
     *	Method must be filled in child classes.
     *	Used for compare two any items.
     *  @protected
     *	@param {Generic} item - item of your state.
     *	@return {Generic} identify param of item.
     */
    getItemId(item) {
        return item;
    }
    /**
     * 	Compare two items via `getItemId`
     *	@private
     *	@param {Generic} itemToUpdate - item that will be update.
     *	@return {boolean} result of comparing two items via `getItemId`.
     */
    compareItems(firstItem, secondItem) {
        return (this.getItemId(firstItem) === this.getItemId(secondItem));
    }
}
__decorate([
    Action
], ArrayState.prototype, "unshiftItem", null);
__decorate([
    Action
], ArrayState.prototype, "shift", null);
__decorate([
    Action
], ArrayState.prototype, "pop", null);
__decorate([
    Action
], ArrayState.prototype, "concatWith", null);
__decorate([
    Action
], ArrayState.prototype, "pushItem", null);
__decorate([
    Action
], ArrayState.prototype, "insertItemByIndex", null);
__decorate([
    Action
], ArrayState.prototype, "removeItem", null);
__decorate([
    Action
], ArrayState.prototype, "removeItemById", null);
__decorate([
    Action
], ArrayState.prototype, "removeItemByIndex", null);
__decorate([
    Action
], ArrayState.prototype, "updateItem", null);
__decorate([
    Action
], ArrayState.prototype, "updateItemByIndex", null);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXJyYXkuc3RhdGUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9saWJyYXJ5L3NyYy9saWIvc3RhdGVzL2FycmF5LnN0YXRlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUUsT0FBTyxJQUFJLE1BQU0sRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUNsRCxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sY0FBYyxDQUFDO0FBRXpDOzs7O0dBSUc7QUFDSCxNQUFNLE9BQWdCLFVBQWMsU0FBUSxTQUFjO0lBQ3REOzs7Ozs7T0FNRztJQUNJLFVBQVUsQ0FBQyxLQUFhO1FBQzNCLE1BQU0sS0FBSyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUM7UUFFeEIsT0FBTyxLQUFNLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDekIsQ0FBQztJQUVEOzs7O09BSUc7SUFFSSxXQUFXLENBQUMsSUFBTztRQUN0QixNQUFNLEtBQUssR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDO1FBRXhCLEtBQU0sQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7UUFFckIsSUFBSSxDQUFDLFdBQVcsQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUM1QixDQUFDO0lBRUQ7OztPQUdHO0lBRUksS0FBSztRQUNSLE1BQU0sS0FBSyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUM7UUFFeEIsS0FBTSxDQUFDLEtBQUssRUFBRSxDQUFDO1FBRWYsSUFBSSxDQUFDLFdBQVcsQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUM1QixDQUFDO0lBRUQ7OztPQUdHO0lBRUksR0FBRztRQUNOLE1BQU0sS0FBSyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUM7UUFFeEIsS0FBTSxDQUFDLEdBQUcsRUFBRSxDQUFDO1FBRWIsSUFBSSxDQUFDLFdBQVcsQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUM1QixDQUFDO0lBRUQ7Ozs7T0FJRztJQUVJLFVBQVUsQ0FBQyxLQUFV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QUFLLENBQUMsQ0FBQyxDQUFDO1NBQ2pDO2FBQU07WUFDSCxLQUFLLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxDQUFDO1NBQzNCO0lBQ0wsQ0FBQztJQUVrQixVQUFVLENBQUMsS0FBd0IsRUFBRSxVQUFrQjtRQUN0RSxJQUFJLEtBQUssWUFBWSxTQUFTLEVBQUU7WUFDNUIsTUFBTSxJQUFJLEtBQUssQ0FDWCxLQUFLLElBQUksQ0FBQyxXQUFXLENBQUMsSUFBSSxLQUFLLFVBQVUsS0FBSztnQkFDOUMseUJBQXlCLEtBQUssQ0FBQyxPQUFPLEVBQUUsQ0FDM0MsQ0FBQztTQUNMO1FBRUQsS0FBSyxDQUFDLFVBQVUsQ0FBQyxLQUFLLEVBQUUsVUFBVSxDQUFDLENBQUM7SUFDeEMsQ0FBQztJQUVEOzs7Ozs7O09BT0c7SUFDTyxTQUFTLENBQUMsSUFBTztRQUN2QixPQUFPLElBQUksQ0FBQztJQUNoQixDQUFDO0lBRUQ7Ozs7O09BS0c7SUFDSyxZQUFZLENBQUMsU0FBWSxFQUFFLFVBQWE7UUFDNUMsT0FBTyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsU0FBUyxDQUFDLEtBQUssSUFBSSxDQUFDLFNBQVMsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDO0lBQ3RFLENBQUM7Q0FDSjtBQWxNRztJQURDLE1BQU07NkNBT047QUFPRDtJQURDLE1BQU07dUNBT047QUFPRDtJQURDLE1BQU07cUNBT047QUFRRDtJQURDLE1BQU07NENBTU47QUFRRDtJQURDLE1BQU07MENBT047QUFTRDtJQURDLE1BQU07bURBTU47QUFRRDtJQURDLE1BQU07NENBT047QUFRRDtJQURDLE1BQU07Z0RBT047QUFRRDtJQURDLE1BQU07bURBVU47QUFRRDtJQURDLE1BQU07NENBWU47QUFTRDtJQURDLE1BQU07bURBT04iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyDJtUFjdGlvbiBhcyBBY3Rpb24gfSBmcm9tICcuLi9kZWNvcmF0b3JzJztcbmltcG9ydCB7IEJhc2VTdGF0ZSB9IGZyb20gJy4vYmFzZS5zdGF0ZSc7XG5cbi8qKlxuICpcdEBjbGFzc1xuICpcdEBhYnN0cmFjdFxuICpcdEBjbGFzc2RlcyBBcnJheSBzdGF0ZSBjbGFzcy4gSW1wbGVtZW50aW5nIGJhc2UgYXJyYXkgZnVuY3Rpb25hbGl0eS5cbiAqL1xuZXhwb3J0IGFic3RyYWN0IGNsYXNzIEFycmF5U3RhdGU8VD4gZXh0ZW5kcyBCYXNlU3RhdGU8VFtdPiB7XG4gICAgLyoqXG4gICAgICogXHRSZXR1cm4gaXRlbSBieSBxdWlyZWQgaW5kZXguXG4gICAgICpcdEBwdWJsaWNcbiAgICAgKlx0QHBhcmFtIHtOdW1iZXJ9IGluZGV4IC0gUXVpcmVkIGluZGV4XG4gICAgICogIEBkZXByZWNhdGVkIHVzZSBgdGhpcy5kYXRhW2luZGV4XWAgaW5zdGVhZFxuICAgICAqXHRAcmV0dXJuIHtHZW5lcmljfSBxdWlyZWQgaXRlbS5cbiAgICAgKi9cbiAgICBwdWJsaWMgZ2V0QnlJbmRleChpbmRleDogbnVtYmVyKTogVCB8IHVuZGVmaW5lZCB7XG4gICAgICAgIGNvbnN0IGl0ZW1zID0gdGhpcy5kYXRhO1xuXG4gICAgICAgIHJldHVybiBpdGVtcyFbaW5kZXhdO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFx0VW5zaGlmdCBpdGVtIHRvIGFycmF5IGluIHN0YXRlLlxuICAgICAqXHRAcHVibGljXG4gICAgICpcdEBwYXJhbSB7R2VuZXJpY30gaXRlbSAtIEl0ZW0gbmVlZHMgdG8gdW5zaGlmdC5cbiAgICAgKi9cbiAgICBAQWN0aW9uXG4gICAgcHVibGljIHVuc2hpZnRJdGVtKGl0ZW06IFQpOiB2b2lkIHtcbiAgICAgICAgY29uc3QgaXRlbXMgPSB0aGlzLmRhdGE7XG5cbiAgICAgICAgaXRlbXMhLnVuc2hpZnQoaXRlbSk7XG5cbiAgICAgICAgdGhpcy5zZXROZXdWYWx1ZShpdGVtcyk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogXHRTaGlmdCBhcnJheSBpbiBzdGF0ZS5cbiAgICAgKlx0QHB1YmxpY1xuICAgICAqL1xuICAgIEBBY3Rpb25cbiAgICBwdWJsaWMgc2hpZnQoKTogdm9pZCB7XG4gICAgICAgIGNvbnN0IGl0ZW1zID0gdGhpcy5kYXRhO1xuXG4gICAgICAgIGl0ZW1zIS5zaGlmdCgpO1xuXG4gICAgICAgIHRoaXMuc2V0TmV3VmFsdWUoaXRlbXMpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFx0UG9wIGFycmF5IGluIHN0YXRlLlxuICAgICAqXHRAcHVibGljXG4gICAgICovXG4gICAgQEFjdGlvblxuICAgIHB1YmxpYyBwb3AoKTogdm9pZCB7XG4gICAgICAgIGNvbnN0IGl0ZW1zID0gdGhpcy5kYXRhO1xuXG4gICAgICAgIGl0ZW1zIS5wb3AoKTtcblxuICAgICAgICB0aGlzLnNldE5ld1ZhbHVlKGl0ZW1zKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBcdENvbmNhdCBjdXJyZW50IHN0YXRlIHdpdGggYW5vdGhlciBhcnJheS5cbiAgICAgKlx0QHBhcmFtIHtUW119IGFycmF5IC0gQW5vdGhlciBhcnJheSB0byBjb25jYXQgd2l0aCB0aGUgY3VycmVudCBzdGF0ZS5cbiAgICAgKlx0QHB1YmxpY1xuICAgICAqL1xuICAgIEBBY3Rpb25cbiAgICBwdWJsaWMgY29uY2F0V2l0aChhcnJheTogVFtdKTogdm9pZCB7XG4gICAgICAgIGNvbnN0IGl0ZW1zID0gdGhpcy5kYXRhO1xuICAgICAgICBjb25zdCBuZXdJdGVtcyA9IGl0ZW1zIS5jb25jYXQoYXJyYXkpO1xuXG4gICAgICAgIHRoaXMuc2V0TmV3VmFsdWUobmV3SXRlbXMpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFx0UHVzaCBpdGVtIHRvIGFycmF5IGluIHN0YXRlLlxuICAgICAqXHRAcHVibGljXG4gICAgICpcdEBwYXJhbSB7R2VuZXJpY30gaXRlbSAtIEl0ZW0gbmVlZHMgdG8gcHVzaFxuICAgICAqL1xuICAgIEBBY3Rpb25cbiAgICBwdWJsaWMgcHVzaEl0ZW0oaXRlbTogVCk6IHZvaWQge1xuICAgICAgICBjb25zdCBpdGVtcyA9IHRoaXMuZGF0YTtcblxuICAgICAgICBpdGVtcyEucHVzaChpdGVtKTtcblxuICAgICAgICB0aGlzLnNldE5ld1ZhbHVlKGl0ZW1zKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBcdEluc2VydCBpdGVtIGluIGFycmF5IGJ5IGluZGV4LlxuICAgICAqXHRAcHVibGljXG4gICAgICpcdEBwYXJhbSB7bnVtYmVyfSBpbmRleCAtIEluZGV4IHdoZXJlIHRvIGluc2VydCBuZXcgaXRlbS5cbiAgICAgKlx0QHBhcmFtIHtHZW5lcmljfSBpdGVtIC0gSXRlbSBuZWVkIHRvIGluc2VydC5cbiAgICAgKi9cbiAgICBAQWN0aW9uXG4gICAgcHVibGljIGluc2VydEl0ZW1CeUluZGV4KGluZGV4OiBudW1iZXIsIGl0ZW06IFQpOiB2b2lkIHtcbiAgICAgICAgY29uc3QgaXRlbXMgPSB0aGlzLmRhdGE7XG5cbiAgICAgICAgaXRlbXMhLnNwbGljZShpbmRleCwgMCwgaXRlbSk7XG4gICAgICAgIHRoaXMuc2V0TmV3VmFsdWUoaXRlbXMpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFx0UmVtb3ZlIGl0ZW0gaW4gYXJyYXkgYnkgaXRlbSBpZGVudGlmeSBwYXJhbSAodXNpbmcgYGNvbXBhcmVJdGVtc2AgbWV0aG9kKS5cbiAgICAgKlx0QHB1YmxpY1xuICAgICAqXHRAcGFyYW0ge0dlbmVyaWN9IGl0ZW1JZCAtIElkIG9mIGl0ZW0geW91IHdhbnQgdG8gcmVtb3ZlLlxuICAgICAqL1xuICAgIEBBY3Rpb25cbiAgICBwdWJsaWMgcmVtb3ZlSXRlbShpdGVtOiBUKTogVCB8IHVuZGVmaW5lZCB7XG4gICAgICAgIGNvbnN0IGluZGV4ID0gdGhpcy5kYXRhIS5maW5kSW5kZXgoKF9pdGVtKSA9PlxuICAgICAgICAgICAgdGhpcy5jb21wYXJlSXRlbXMoaXRlbSwgX2l0ZW0pXG4gICAgICAgICk7XG5cbiAgICAgICAgcmV0dXJuIHRoaXMucmVtb3ZlSXRlbUJ5SW5kZXgoaW5kZXgpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFx0UmVtb3ZlIGl0ZW0gaW4gYXJyYXkgYnkgaXRlbSBpZCAodXNpbmcgYGdldEl0ZW1JZGAgbWV0aG9kKS5cbiAgICAgKlx0QHB1YmxpY1xuICAgICAqXHRAcGFyYW0ge0dlbmVyaWN9IGl0ZW1JZCAtIElkIG9mIGl0ZW0geW91IHdhbnQgdG8gcmVtb3ZlLlxuICAgICAqL1xuICAgIEBBY3Rpb25cbiAgICBwdWJsaWMgcmVtb3ZlSXRlbUJ5SWQoaXRlbUlkOiB1bmtub3duKTogVCB8IHVuZGVmaW5lZCB7XG4gICAgICAgIGNvbnN0IGluZGV4ID0gdGhpcy5kYXRhIS5maW5kSW5kZXgoXG4gICAgICAgICAgICAoX2l0ZW0pID0+IGl0ZW1JZCA9PT0gdGhpcy5nZXRJdGVtSWQoX2l0ZW0pXG4gICAgICAgICk7XG5cbiAgICAgICAgcmV0dXJuIHRoaXMucmVtb3ZlSXRlbUJ5SW5kZXgoaW5kZXgpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFx0UmVtb3ZlIGl0ZW0gaW4gYXJyYXkgYnkgaW5kZXguXG4gICAgICpcdEBwdWJsaWNcbiAgICAgKlx0QHBhcmFtIHtudW1iZXJ9IGluZGV4IC0gSW5kZXggb2YgaXRlbSB5b3Ugd2FudCB0byByZW1vdmUuXG4gICAgICovXG4gICAgQEFjdGlvblxuICAgIHB1YmxpYyByZW1vdmVJdGVtQnlJbmRleChpbmRleDogbnVtYmVyKTogVCB8IHVuZGVmaW5lZCB7XG4gICAgICAgIGNvbnN0IGl0ZW1zID0gdGhpcy5kYXRhO1xuICAgICAgICBjb25zdCByZW1vdmVkSXRlbSA9IHRoaXMuZGF0YSFbaW5kZXhdO1xuXG4gICAgICAgIGl0ZW1zIS5zcGxpY2UoaW5kZXgsIDEpO1xuXG4gICAgICAgIHRoaXMuc2V0TmV3VmFsdWUoaXRlbXMpO1xuXG4gICAgICAgIHJldHVybiByZW1vdmVkSXRlbTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBcdFVwZGF0ZSBpdGVtIGluIGFycmF5IGJ5IGl0ZW0gaWRlbnRpZnkgcGFyYW0gKHVzaW5nIGBjb21wYXJlSXRlbXNgIG1ldGhvZCkuXG4gICAgICpcdEBwdWJsaWNcbiAgICAqXHRAcGFyYW0ge0dlbmVyaWN9IGl0ZW1Ub1VwZGF0ZSAtIGl0ZW0gdGhhdCB3aWxsIGJlIHVwZGF0ZS5cbiAgICAqL1xuICAgIEBBY3Rpb25cbiAgICBwdWJsaWMgdXBkYXRlSXRlbShpdGVtVG9VcGRhdGU6IFQpOiB2b2lkIHtcbiAgICAgICAgY29uc3QgaXRlbXMgPSB0aGlzLmRhdGE7XG4gICAgICAgIGNvbnN0IG5ld0l0ZW1Ub1VwZGF0ZSA9IHsgLi4uaXRlbVRvVXBkYXRlIH07XG5cbiAgICAgICAgY29uc3QgaXRlbUluZGV4ID0gaXRlbXMhLmZpbmRJbmRleCgoX2N1cnJlbnRJdGVtKSA9PlxuICAgICAgICAgICAgdGhpcy5jb21wYXJlSXRlbXMoX2N1cnJlbnRJdGVtLCBuZXdJdGVtVG9VcGRhdGUpXG4gICAgICAgICk7XG5cbiAgICAgICAgaXRlbXMhW2l0ZW1JbmRleF0gPSBuZXdJdGVtVG9VcGRhdGU7XG5cbiAgICAgICAgdGhpcy5zZXROZXdWYWx1ZShpdGVtcyk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogXHRVcGRhdGUgaXRlbSBpbiBhcnJheSBieSBpbmRleC5cbiAgICAgKlx0QHB1YmxpY1xuICAgICAqXHRAcGFyYW0ge0dlbmVyaWN9IGl0ZW1Ub1VwZGF0ZSAtIGl0ZW0gdGhhdCB3aWxsIGJlIHVwZGF0ZS5cbiAgICAgKlx0QHBhcmFtIHtHZW5lcmljfSBpbmRleCAtIGluZGV4IG9mIGl0ZW0gdGhhdCBuZWVkIHRvIHVwZGF0ZS5cbiAgICAgKi9cbiAgICBAQWN0aW9uXG4gICAgcHVibGljIHVwZGF0ZUl0ZW1CeUluZGV4KGl0ZW1Ub1VwZGF0ZTogVCwgaW5kZXg6IG51bWJlcik6IHZvaWQge1xuICAgICAgICBjb25zdCBpdGVtcyA9IHRoaXMuZGF0YTtcblxuICAgICAgICBpdGVtcyFbaW5kZXhdID0gaXRlbVRvVXBkYXRlO1xuXG4gICAgICAgIHRoaXMuc2V0TmV3VmFsdWUoaXRlbXMpO1xuICAgIH1cblxuICAgIHByb3RlY3RlZCBvdmVycmlkZSBzZXROZXdWYWx1ZSh2YWx1ZTogVFtdIHwgbnVsbCk6IHZvaWQge1xuICAgICAgICBpZiAodmFsdWUpIHtcbiAgICAgICAgICAgIHN1cGVyLnNldE5ld1ZhbHVlKFsuLi52YWx1ZV0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgc3VwZXIuc2V0TmV3VmFsdWUobnVsbCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgb3ZlcnJpZGUgY2F0Y2hFcnJvcihlcnJvcjogRXJyb3IgfCBUeXBlRXJyb3IsIGFjdGlvbk5hbWU6IHN0cmluZyk6IHZvaWQge1xuICAgICAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBUeXBlRXJyb3IpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICAgICAgICBgXFxuJHt0aGlzLmNvbnN0cnVjdG9yLm5hbWV9IFske2FjdGlvbk5hbWV9XTogYCArXG4gICAgICAgICAgICAgICAgYEZpcnN0bHkgc2V0IEFycmF5LlxcblxcbiR7ZXJyb3IubWVzc2FnZX1gXG4gICAgICAgICAgICApO1xuICAgICAgICB9XG5cbiAgICAgICAgc3VwZXIuY2F0Y2hFcnJvcihlcnJvciwgYWN0aW9uTmFtZSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICpcdE11c3QgcmV0dXJuIGlkZW50aWZ5IHBhcmFtIG9mIGl0ZW0uXG4gICAgICpcdE1ldGhvZCBtdXN0IGJlIGZpbGxlZCBpbiBjaGlsZCBjbGFzc2VzLlxuICAgICAqXHRVc2VkIGZvciBjb21wYXJlIHR3byBhbnkgaXRlbXMuXG4gICAgICogIEBwcm90ZWN0ZWRcbiAgICAgKlx0QHBhcmFtIHtHZW5lcmljfSBpdGVtIC0gaXRlbSBvZiB5b3VyIHN0YXRlLlxuICAgICAqXHRAcmV0dXJuIHtHZW5lcmljfSBpZGVudGlmeSBwYXJhbSBvZiBpdGVtLlxuICAgICAqL1xuICAgIHByb3RlY3RlZCBnZXRJdGVtSWQoaXRlbTogVCk6IGFueSB7XG4gICAgICAgIHJldHVybiBpdGVtO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFx0Q29tcGFyZSB0d28gaXRlbXMgdmlhIGBnZXRJdGVtSWRgXG4gICAgICpcdEBwcml2YXRlXG4gICAgICpcdEBwYXJhbSB7R2VuZXJpY30gaXRlbVRvVXBkYXRlIC0gaXRlbSB0aGF0IHdpbGwgYmUgdXBkYXRlLlxuICAgICAqXHRAcmV0dXJuIHtib29sZWFufSByZXN1bHQgb2YgY29tcGFyaW5nIHR3byBpdGVtcyB2aWEgYGdldEl0ZW1JZGAuXG4gICAgICovXG4gICAgcHJpdmF0ZSBjb21wYXJlSXRlbXMoZmlyc3RJdGVtOiBULCBzZWNvbmRJdGVtOiBUKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiAodGhpcy5nZXRJdGVtSWQoZmlyc3RJdGVtKSA9PT0gdGhpcy5nZXRJdGVtSWQoc2Vjb25kSXRlbSkpO1xuICAgIH1cbn1cbiJdfQ==